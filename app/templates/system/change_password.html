{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1 class="mb-4">修改密码</h1>
    
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">密码修改</h5>
            <form>
                <div class="mb-3">
                    <label for="currentPassword" class="form-label">当前密码</label>
                    <input type="password" class="form-control" id="currentPassword" required>
                    <div class="form-text">请输入您当前的密码</div>
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">新密码</label>
                    <input type="password" class="form-control" id="newPassword" required>
                    <div class="form-text">密码长度至少8个字符，必须包含字母和数字</div>
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">确认新密码</label>
                    <input type="password" class="form-control" id="confirmPassword" required>
                    <div class="form-text">请再次输入新密码</div>
                </div>
                <button type="submit" class="btn btn-primary">修改密码</button>
                <a href="{{ url_for('system.profile') }}" class="btn btn-secondary">取消</a>
            </form>
        </div>
    </div>
    
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">密码安全建议</h5>
            <ul>
                <li>使用至少8个字符的密码</li>
                <li>混合使用大小写字母、数字和特殊字符</li>
                <li>避免使用常见词汇、个人信息或连续字符</li>
                <li>定期更换密码，不要重复使用旧密码</li>
                <li>不要在多个网站或应用中使用相同的密码</li>
                <li>不要将密码告诉他人或在纸上记录密码</li>
            </ul>
        </div>
    </div>
    
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">密码强度检测</h5>
            <div class="mb-3">
                <label for="passwordStrength" class="form-label">测试密码强度</label>
                <input type="password" class="form-control" id="passwordStrength" placeholder="输入密码测试强度">
            </div>
            <div class="progress mb-3">
                <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="strengthBar">弱</div>
            </div>
            <div class="alert alert-info" id="strengthTips">
                <strong>提示：</strong> 输入密码以查看强度提示
            </div>
        </div>
    </div>
    
    <div class="d-flex justify-content-between mt-4">
        <a href="{{ url_for('system.profile') }}" class="btn btn-secondary">返回个人资料</a>
        <div>
            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal">忘记密码</button>
        </div>
    </div>
</div>

<!-- 忘记密码模态框 -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="forgotPasswordModalLabel">忘记密码</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="resetEmail" class="form-label">邮箱地址</label>
                        <input type="email" class="form-control" id="resetEmail" required>
                        <div class="form-text">请输入您注册时使用的邮箱地址，我们将向该邮箱发送密码重置链接</div>
                    </div>
                    <div class="mb-3">
                        <label for="verifyCode" class="form-label">验证码</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="verifyCode" required>
                            <button class="btn btn-outline-secondary" type="button" id="sendVerifyCode">发送验证码</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="resetPassword">重置密码</button>
            </div>
        </div>
    </div>
</div>

<script>
// 密码强度检测
document.getElementById('passwordStrength').addEventListener('input', function() {
    const password = this.value;
    const strengthBar = document.getElementById('strengthBar');
    const strengthTips = document.getElementById('strengthTips');
    
    let strength = 0;
    let tips = '';
    
    if (password.length >= 8) strength += 25;
    if (password.length >= 12) strength += 10;
    if (/[a-z]/.test(password)) strength += 15;
    if (/[A-Z]/.test(password)) strength += 15;
    if (/[0-9]/.test(password)) strength += 15;
    if (/[^a-zA-Z0-9]/.test(password)) strength += 20;
    
    strengthBar.style.width = strength + '%';
    strengthBar.setAttribute('aria-valuenow', strength);
    
    if (strength < 30) {
        strengthBar.className = 'progress-bar bg-danger';
        strengthBar.textContent = '弱';
        tips = '<strong>提示：</strong> 密码强度较弱，建议增加密码长度，包含大小写字母、数字和特殊字符';
    } else if (strength < 70) {
        strengthBar.className = 'progress-bar bg-warning';
        strengthBar.textContent = '中';
        tips = '<strong>提示：</strong> 密码强度中等，可以进一步增加特殊字符或密码长度';
    } else {
        strengthBar.className = 'progress-bar bg-success';
        strengthBar.textContent = '强';
        tips = '<strong>提示：</strong> 密码强度很高，安全性良好';
    }
    
    strengthTips.innerHTML = tips;
});

// 发送验证码
document.getElementById('sendVerifyCode').addEventListener('click', function() {
    const email = document.getElementById('resetEmail').value;
    if (!email) {
        alert('请先输入邮箱地址');
        return;
    }
    
    this.disabled = true;
    let countdown = 60;
    const originalText = this.textContent;
    
    const timer = setInterval(() => {
        countdown--;
        this.textContent = `${countdown}秒后重试`;
        
        if (countdown <= 0) {
            clearInterval(timer);
            this.textContent = originalText;
            this.disabled = false;
        }
    }, 1000);
    
    // 这里应该发送AJAX请求到后端发送验证码
    alert('验证码已发送到您的邮箱，请注意查收');
});

// 重置密码
document.getElementById('resetPassword').addEventListener('click', function() {
    const email = document.getElementById('resetEmail').value;
    const verifyCode = document.getElementById('verifyCode').value;
    
    if (!email || !verifyCode) {
        alert('请填写邮箱和验证码');
        return;
    }
    
    // 这里应该发送AJAX请求到后端验证并重置密码
    alert('密码重置链接已发送到您的邮箱，请查收并按照提示操作');
    
    // 关闭模态框
    const modal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
    modal.hide();
});
</script>
{% endblock %}