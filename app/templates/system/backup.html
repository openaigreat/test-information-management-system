{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1 class="mb-4">数据备份</h1>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">备份信息</h5>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">上次备份时间</label>
                        <input type="text" class="form-control" value="2023-10-04 15:30:22" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">备份状态</label>
                        <input type="text" class="form-control" value="成功" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">备份文件大小</label>
                        <input type="text" class="form-control" value="125.6 MB" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">备份文件路径</label>
                        <input type="text" class="form-control" value="/backups/system_backup_20231004.sql" readonly>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">创建备份</h5>
            <form>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="backupType" class="form-label">备份类型</label>
                            <select class="form-select" id="backupType">
                                <option value="full" selected>完整备份</option>
                                <option value="data">仅数据备份</option>
                                <option value="structure">仅结构备份</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="backupFormat" class="form-label">备份格式</label>
                            <select class="form-select" id="backupFormat">
                                <option value="sql" selected>SQL</option>
                                <option value="json">JSON</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="backupPath" class="form-label">备份路径</label>
                            <input type="text" class="form-control" id="backupPath" value="/backups/">
                        </div>
                        <div class="mb-3">
                            <label for="backupName" class="form-label">备份文件名</label>
                            <input type="text" class="form-control" id="backupName" value="system_backup_{{ current_date }}.sql">
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="compressBackup" checked>
                        <label class="form-check-label" for="compressBackup">
                            压缩备份文件
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoDelete">
                        <label class="form-check-label" for="autoDelete">
                            自动删除旧备份（保留最近10个）
                        </label>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" id="startBackup">开始备份</button>
            </form>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">备份进度</h5>
            <div class="progress mb-3">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="backupProgress">0%</div>
            </div>
            <div class="mb-3">
                <label class="form-label">备份状态</label>
                <input type="text" class="form-control" value="等待开始" readonly id="backupStatus">
            </div>
            <div class="mb-3">
                <label class="form-label">备份日志</label>
                <textarea class="form-control" rows="5" readonly id="backupLog"></textarea>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">备份历史</h5>
                <div>
                    <button class="btn btn-success">下载备份</button>
                    <button class="btn btn-danger">删除备份</button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>选择</th>
                            <th>备份文件名</th>
                            <th>备份时间</th>
                            <th>备份类型</th>
                            <th>文件大小</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input class="form-check-input" type="checkbox" id="backup1"></td>
                            <td>system_backup_20231004.sql</td>
                            <td>2023-10-04 15:30:22</td>
                            <td>完整备份</td>
                            <td>125.6 MB</td>
                            <td><span class="badge bg-success">成功</span></td>
                            <td>
                                <button class="btn btn-sm btn-info">查看</button>
                                <button class="btn btn-sm btn-success">下载</button>
                                <button class="btn btn-sm btn-danger">删除</button>
                            </td>
                        </tr>
                        <tr>
                            <td><input class="form-check-input" type="checkbox" id="backup2"></td>
                            <td>system_backup_20231003.sql</td>
                            <td>2023-10-03 15:30:22</td>
                            <td>完整备份</td>
                            <td>124.8 MB</td>
                            <td><span class="badge bg-success">成功</span></td>
                            <td>
                                <button class="btn btn-sm btn-info">查看</button>
                                <button class="btn btn-sm btn-success">下载</button>
                                <button class="btn btn-sm btn-danger">删除</button>
                            </td>
                        </tr>
                        <tr>
                            <td><input class="form-check-input" type="checkbox" id="backup3"></td>
                            <td>system_backup_20231002.sql</td>
                            <td>2023-10-02 15:30:22</td>
                            <td>完整备份</td>
                            <td>123.5 MB</td>
                            <td><span class="badge bg-success">成功</span></td>
                            <td>
                                <button class="btn btn-sm btn-info">查看</button>
                                <button class="btn btn-sm btn-success">下载</button>
                                <button class="btn btn-sm btn-danger">删除</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">上一页</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">下一页</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    
    <div class="d-flex justify-content-between mt-4">
        <a href="{{ url_for('system.index') }}" class="btn btn-secondary">返回系统设置</a>
        <div>
            <button class="btn btn-warning">备份设置</button>
        </div>
    </div>
</div>

<script>
document.getElementById('startBackup').addEventListener('click', function() {
    // 模拟备份进度
    let progress = 0;
    const progressBar = document.getElementById('backupProgress');
    const statusInput = document.getElementById('backupStatus');
    const logTextarea = document.getElementById('backupLog');
    
    statusInput.value = '备份中...';
    logTextarea.value = '开始备份...\n';
    
    const interval = setInterval(function() {
        progress += 5;
        progressBar.style.width = progress + '%';
        progressBar.setAttribute('aria-valuenow', progress);
        progressBar.textContent = progress + '%';
        
        logTextarea.value += '备份进度: ' + progress + '%\n';
        logTextarea.scrollTop = logTextarea.scrollHeight;
        
        if (progress >= 100) {
            clearInterval(interval);
            statusInput.value = '备份完成';
            logTextarea.value += '备份完成！\n';
            logTextarea.scrollTop = logTextarea.scrollHeight;
        }
    }, 500);
});
</script>
{% endblock %}